<html><style type="text/css">
span.lineno { color: white; background: #aaaaaa; border-right: solid white 12px }
span.nottickedoff { background: yellow}
span.istickedoff { background: white }
span.tickonlyfalse { margin: -1px; border: 1px solid #f20913; background: #f20913 }
span.tickonlytrue  { margin: -1px; border: 1px solid #60de51; background: #60de51 }
span.funcount { font-size: small; color: orange; z-index: 2; position: absolute; right: 20 }
span.decl { font-weight: bold }
span.spaces    { background: white }
</style>
<pre>
<span class="lineno">    1 </span>{-# LANGUAGE BangPatterns        #-}
<span class="lineno">    2 </span>{-# LANGUAGE CPP                 #-}
<span class="lineno">    3 </span>{-# LANGUAGE OverloadedStrings   #-}
<span class="lineno">    4 </span>{-# LANGUAGE ScopedTypeVariables #-}
<span class="lineno">    5 </span>
<span class="lineno">    6 </span>-- | Contains web handlers to serve files from a directory.
<span class="lineno">    7 </span>module Snap.Internal.Util.FileServe
<span class="lineno">    8 </span>  ( -- * Helper functions
<span class="lineno">    9 </span>    getSafePath
<span class="lineno">   10 </span>    -- * Configuration for directory serving
<span class="lineno">   11 </span>  , MimeMap
<span class="lineno">   12 </span>  , HandlerMap
<span class="lineno">   13 </span>  , DirectoryConfig(..)
<span class="lineno">   14 </span>  , simpleDirectoryConfig
<span class="lineno">   15 </span>  , defaultDirectoryConfig
<span class="lineno">   16 </span>  , fancyDirectoryConfig
<span class="lineno">   17 </span>  , defaultIndexGenerator
<span class="lineno">   18 </span>  , defaultMimeTypes
<span class="lineno">   19 </span>  , fileType
<span class="lineno">   20 </span>    -- * File servers
<span class="lineno">   21 </span>  , serveDirectory
<span class="lineno">   22 </span>  , serveDirectoryWith
<span class="lineno">   23 </span>  , serveFile
<span class="lineno">   24 </span>  , serveFileAs
<span class="lineno">   25 </span>    -- * Internal functions
<span class="lineno">   26 </span>  , decodeFilePath
<span class="lineno">   27 </span>  ) where
<span class="lineno">   28 </span>
<span class="lineno">   29 </span>------------------------------------------------------------------------------
<span class="lineno">   30 </span>import           Control.Applicative              (Alternative ((&lt;|&gt;)), Applicative ((*&gt;), (&lt;*)), (&lt;$&gt;))
<span class="lineno">   31 </span>import           Control.Exception.Lifted         (SomeException, catch, evaluate)
<span class="lineno">   32 </span>import           Control.Monad                    (Monad ((&gt;&gt;), (&gt;&gt;=), return), filterM, forM_, liftM, unless, void, when, (=&lt;&lt;))
<span class="lineno">   33 </span>import           Control.Monad.IO.Class           (MonadIO (..))
<span class="lineno">   34 </span>import           Data.Attoparsec.ByteString.Char8 (Parser, char, endOfInput, option, string)
<span class="lineno">   35 </span>import           Data.ByteString.Builder          (Builder, byteString, char8, stringUtf8, toLazyByteString)
<span class="lineno">   36 </span>import           Data.ByteString.Char8            (ByteString)
<span class="lineno">   37 </span>import qualified Data.ByteString.Char8            as S (append, concat, intercalate, isSuffixOf, null, pack, takeWhile)
<span class="lineno">   38 </span>import qualified Data.ByteString.Lazy.Char8       as L
<span class="lineno">   39 </span>import           Data.HashMap.Strict              (HashMap)
<span class="lineno">   40 </span>import qualified Data.HashMap.Strict              as Map (empty, fromList, lookup)
<span class="lineno">   41 </span>import           Data.List                        (drop, dropWhile, elem, filter, foldl', null, sort, (++))
<span class="lineno">   42 </span>import           Data.Maybe                       (fromMaybe, isNothing)
<span class="lineno">   43 </span>import           Data.Monoid                      (Monoid (mappend, mconcat))
<span class="lineno">   44 </span>import qualified Data.Text                        as T (Text, pack, unpack)
<span class="lineno">   45 </span>import qualified Data.Text.Encoding               as T (decodeUtf8, encodeUtf8)
<span class="lineno">   46 </span>import           Data.Word                        (Word64)
<span class="lineno">   47 </span>import           Prelude                          (Bool (..), Eq (..), FilePath, IO, Maybe (Just, Nothing), Num (..), Ord (..), Show (show), String, const, either, flip, fromIntegral, id, maybe, not, ($), ($!), (.), (||))
<span class="lineno">   48 </span>import qualified Prelude
<span class="lineno">   49 </span>import           Snap.Core                        (MonadSnap (..), Request (rqPathInfo, rqQueryString, rqURI), deleteHeader, emptyResponse, finishWith, formatHttpTime, getHeader, getRequest, modifyResponse, parseHttpTime, pass, redirect, sendFile, sendFilePartial, setContentLength, setContentType, setHeader, setResponseBody, setResponseCode, urlDecode, writeBS)
<span class="lineno">   50 </span>import           Snap.Internal.Debug              (debug)
<span class="lineno">   51 </span>import           Snap.Internal.Parsing            (fullyParse, parseNum)
<span class="lineno">   52 </span>import           System.Directory                 (doesDirectoryExist, doesFileExist, getDirectoryContents)
<span class="lineno">   53 </span>import           System.FilePath                  (isRelative, joinPath, splitDirectories, takeExtensions, takeFileName, (&lt;/&gt;))
<span class="lineno">   54 </span>import           System.PosixCompat.Files         (fileSize, getFileStatus, modificationTime)
<span class="lineno">   55 </span>
<span class="lineno">   56 </span>
<span class="lineno">   57 </span>------------------------------------------------------------------------------
<span class="lineno">   58 </span>-- | Gets a path from the 'Request' using 'rqPathInfo' and makes sure it is
<span class="lineno">   59 </span>-- safe to use for opening files.  A path is safe if it is a relative path
<span class="lineno">   60 </span>-- and has no &quot;..&quot; elements to escape the intended directory structure.
<span class="lineno">   61 </span>--
<span class="lineno">   62 </span>-- Example:
<span class="lineno">   63 </span>--
<span class="lineno">   64 </span>-- @
<span class="lineno">   65 </span>-- ghci&gt; :set -XOverloadedStrings
<span class="lineno">   66 </span>-- ghci&gt; import qualified &quot;Data.Map&quot; as M
<span class="lineno">   67 </span>-- ghci&gt; import qualified &quot;Snap.Test&quot; as T
<span class="lineno">   68 </span>-- ghci&gt; import qualified &quot;Data.ByteString.Char8&quot; as B8
<span class="lineno">   69 </span>-- ghci&gt; T.runHandler (T.get \&quot;\/foo\/bar\&quot; M.empty) ('getSafePath' &gt;&gt;= 'writeBS' . B8.pack)
<span class="lineno">   70 </span>-- HTTP\/1.1 200 OK
<span class="lineno">   71 </span>-- server: Snap\/test
<span class="lineno">   72 </span>-- date: Fri, 08 Aug 2014 16:13:20 GMT
<span class="lineno">   73 </span>--
<span class="lineno">   74 </span>-- foo\/bar
<span class="lineno">   75 </span>-- ghci&gt; T.runHandler (T.get \&quot;\/foo\/..\/bar\&quot; M.empty) ('getSafePath' &gt;&gt;= 'writeBS' . B8.pack)
<span class="lineno">   76 </span>-- HTTP\/1.1 404 Not Found
<span class="lineno">   77 </span>-- ...
<span class="lineno">   78 </span>-- @
<span class="lineno">   79 </span>getSafePath :: MonadSnap m =&gt; m FilePath
<span class="lineno">   80 </span><span class="decl"><span class="istickedoff">getSafePath = do</span>
<span class="lineno">   81 </span><span class="spaces">    </span><span class="istickedoff">req &lt;- getRequest</span>
<span class="lineno">   82 </span><span class="spaces">    </span><span class="istickedoff">let mp = urlDecode $ rqPathInfo req</span>
<span class="lineno">   83 </span><span class="spaces"></span><span class="istickedoff"></span>
<span class="lineno">   84 </span><span class="spaces">    </span><span class="istickedoff">p &lt;- maybe pass (return . T.unpack . T.decodeUtf8) mp</span>
<span class="lineno">   85 </span><span class="spaces"></span><span class="istickedoff"></span>
<span class="lineno">   86 </span><span class="spaces">    </span><span class="istickedoff">-- relative paths only!</span>
<span class="lineno">   87 </span><span class="spaces">    </span><span class="istickedoff">when (not $ isRelative p) pass</span>
<span class="lineno">   88 </span><span class="spaces"></span><span class="istickedoff"></span>
<span class="lineno">   89 </span><span class="spaces">    </span><span class="istickedoff">-- check that we don't have any sneaky .. paths</span>
<span class="lineno">   90 </span><span class="spaces">    </span><span class="istickedoff">let dirs = splitDirectories p</span>
<span class="lineno">   91 </span><span class="spaces">    </span><span class="istickedoff">when (elem &quot;..&quot; dirs) pass</span>
<span class="lineno">   92 </span><span class="spaces"></span><span class="istickedoff"></span>
<span class="lineno">   93 </span><span class="spaces">    </span><span class="istickedoff">return $! joinPath dirs</span></span>
<span class="lineno">   94 </span>
<span class="lineno">   95 </span>
<span class="lineno">   96 </span>------------------------------------------------------------------------------
<span class="lineno">   97 </span>-- | A type alias for dynamic handlers
<span class="lineno">   98 </span>type HandlerMap m = HashMap FilePath (FilePath -&gt; m ())
<span class="lineno">   99 </span>
<span class="lineno">  100 </span>
<span class="lineno">  101 </span>------------------------------------------------------------------------------
<span class="lineno">  102 </span>-- | A type alias for MIME type
<span class="lineno">  103 </span>type MimeMap = HashMap FilePath ByteString
<span class="lineno">  104 </span>
<span class="lineno">  105 </span>
<span class="lineno">  106 </span>------------------------------------------------------------------------------
<span class="lineno">  107 </span>-- | The default set of mime type mappings we use when serving files. Its
<span class="lineno">  108 </span>-- value:
<span class="lineno">  109 </span>--
<span class="lineno">  110 </span>-- &gt; Map.fromList [
<span class="lineno">  111 </span>-- &gt;   ( &quot;.asc&quot;     , &quot;text/plain&quot;                                             ),
<span class="lineno">  112 </span>-- &gt;   ( &quot;.asf&quot;     , &quot;video/x-ms-asf&quot;                                         ),
<span class="lineno">  113 </span>-- &gt;   ( &quot;.asx&quot;     , &quot;video/x-ms-asf&quot;                                         ),
<span class="lineno">  114 </span>-- &gt;   ( &quot;.au&quot;      , &quot;audio/basic&quot;                                            ),
<span class="lineno">  115 </span>-- &gt;   ( &quot;.avi&quot;     , &quot;video/x-msvideo&quot;                                        ),
<span class="lineno">  116 </span>-- &gt;   ( &quot;.bmp&quot;     , &quot;image/bmp&quot;                                              ),
<span class="lineno">  117 </span>-- &gt;   ( &quot;.bz2&quot;     , &quot;application/x-bzip&quot;                                     ),
<span class="lineno">  118 </span>-- &gt;   ( &quot;.c&quot;       , &quot;text/plain&quot;                                             ),
<span class="lineno">  119 </span>-- &gt;   ( &quot;.class&quot;   , &quot;application/octet-stream&quot;                               ),
<span class="lineno">  120 </span>-- &gt;   ( &quot;.conf&quot;    , &quot;text/plain&quot;                                             ),
<span class="lineno">  121 </span>-- &gt;   ( &quot;.cpp&quot;     , &quot;text/plain&quot;                                             ),
<span class="lineno">  122 </span>-- &gt;   ( &quot;.css&quot;     , &quot;text/css&quot;                                               ),
<span class="lineno">  123 </span>-- &gt;   ( &quot;.cxx&quot;     , &quot;text/plain&quot;                                             ),
<span class="lineno">  124 </span>-- &gt;   ( &quot;.doc&quot;     , &quot;application/msword&quot;                                     ),
<span class="lineno">  125 </span>-- &gt;   ( &quot;.docx&quot;    , S.append &quot;application/vnd.openxmlformats-officedocument&quot;
<span class="lineno">  126 </span>-- &gt;                           &quot;.wordprocessingml.document&quot;                    ),
<span class="lineno">  127 </span>-- &gt;   ( &quot;.dotx&quot;    , S.append &quot;application/vnd.openxmlformats-officedocument&quot;
<span class="lineno">  128 </span>-- &gt;                           &quot;.wordprocessingml.template&quot;                    ),
<span class="lineno">  129 </span>-- &gt;   ( &quot;.dtd&quot;     , &quot;application/xml-dtd&quot;                                    ),
<span class="lineno">  130 </span>-- &gt;   ( &quot;.dvi&quot;     , &quot;application/x-dvi&quot;                                      ),
<span class="lineno">  131 </span>-- &gt;   ( &quot;.exe&quot;     , &quot;application/octet-stream&quot;                               ),
<span class="lineno">  132 </span>-- &gt;   ( &quot;.flv&quot;     , &quot;video/x-flv&quot;                                            ),
<span class="lineno">  133 </span>-- &gt;   ( &quot;.gif&quot;     , &quot;image/gif&quot;                                              ),
<span class="lineno">  134 </span>-- &gt;   ( &quot;.gz&quot;      , &quot;application/x-gzip&quot;                                     ),
<span class="lineno">  135 </span>-- &gt;   ( &quot;.hs&quot;      , &quot;text/plain&quot;                                             ),
<span class="lineno">  136 </span>-- &gt;   ( &quot;.htm&quot;     , &quot;text/html&quot;                                              ),
<span class="lineno">  137 </span>-- &gt;   ( &quot;.html&quot;    , &quot;text/html&quot;                                              ),
<span class="lineno">  138 </span>-- &gt;   ( &quot;.ico&quot;     , &quot;image/x-icon&quot;                                           ),
<span class="lineno">  139 </span>-- &gt;   ( &quot;.jar&quot;     , &quot;application/x-java-archive&quot;                             ),
<span class="lineno">  140 </span>-- &gt;   ( &quot;.jpeg&quot;    , &quot;image/jpeg&quot;                                             ),
<span class="lineno">  141 </span>-- &gt;   ( &quot;.jpg&quot;     , &quot;image/jpeg&quot;                                             ),
<span class="lineno">  142 </span>-- &gt;   ( &quot;.js&quot;      , &quot;text/javascript&quot;                                        ),
<span class="lineno">  143 </span>-- &gt;   ( &quot;.json&quot;    , &quot;application/json&quot;                                       ),
<span class="lineno">  144 </span>-- &gt;   ( &quot;.log&quot;     , &quot;text/plain&quot;                                             ),
<span class="lineno">  145 </span>-- &gt;   ( &quot;.m3u&quot;     , &quot;audio/x-mpegurl&quot;                                        ),
<span class="lineno">  146 </span>-- &gt;   ( &quot;.m3u8&quot;    , &quot;application/x-mpegURL&quot;                                  ),
<span class="lineno">  147 </span>-- &gt;   ( &quot;.mka&quot;     , &quot;audio/x-matroska&quot;                                       ),
<span class="lineno">  148 </span>-- &gt;   ( &quot;.mk3d&quot;    , &quot;video/x-matroska&quot;                                       ),
<span class="lineno">  149 </span>-- &gt;   ( &quot;.mkv&quot;     , &quot;video/x-matroska&quot;                                       ),
<span class="lineno">  150 </span>-- &gt;   ( &quot;.mov&quot;     , &quot;video/quicktime&quot;                                        ),
<span class="lineno">  151 </span>-- &gt;   ( &quot;.mp3&quot;     , &quot;audio/mpeg&quot;                                             ),
<span class="lineno">  152 </span>-- &gt;   ( &quot;.mp4&quot;     , &quot;video/mp4&quot;                                              ),
<span class="lineno">  153 </span>-- &gt;   ( &quot;.mpeg&quot;    , &quot;video/mpeg&quot;                                             ),
<span class="lineno">  154 </span>-- &gt;   ( &quot;.mpg&quot;     , &quot;video/mpeg&quot;                                             ),
<span class="lineno">  155 </span>-- &gt;   ( &quot;.ogg&quot;     , &quot;application/ogg&quot;                                        ),
<span class="lineno">  156 </span>-- &gt;   ( &quot;.pac&quot;     , &quot;application/x-ns-proxy-autoconfig&quot;                      ),
<span class="lineno">  157 </span>-- &gt;   ( &quot;.pdf&quot;     , &quot;application/pdf&quot;                                        ),
<span class="lineno">  158 </span>-- &gt;   ( &quot;.png&quot;     , &quot;image/png&quot;                                              ),
<span class="lineno">  159 </span>-- &gt;   ( &quot;.potx&quot;    , S.append &quot;application/vnd.openxmlformats-officedocument&quot;
<span class="lineno">  160 </span>-- &gt;                           &quot;.presentationml.template&quot;                      ),
<span class="lineno">  161 </span>-- &gt;   ( &quot;.ppsx&quot;    , S.append &quot;application/vnd.openxmlformats-officedocument&quot;
<span class="lineno">  162 </span>-- &gt;                           &quot;.presentationml.slideshow&quot;                     ),
<span class="lineno">  163 </span>-- &gt;   ( &quot;.ppt&quot;     , &quot;application/vnd.ms-powerpoint&quot;                          ),
<span class="lineno">  164 </span>-- &gt;   ( &quot;.pptx&quot;    , S.append &quot;application/vnd.openxmlformats-officedocument&quot;
<span class="lineno">  165 </span>-- &gt;                           &quot;.presentationml.presentation&quot;                  ),
<span class="lineno">  166 </span>-- &gt;   ( &quot;.ps&quot;      , &quot;application/postscript&quot;                                 ),
<span class="lineno">  167 </span>-- &gt;   ( &quot;.qt&quot;      , &quot;video/quicktime&quot;                                        ),
<span class="lineno">  168 </span>-- &gt;   ( &quot;.rtf&quot;     , &quot;text/rtf&quot;                                               ),
<span class="lineno">  169 </span>-- &gt;   ( &quot;.sig&quot;     , &quot;application/pgp-signature&quot;                              ),
<span class="lineno">  170 </span>-- &gt;   ( &quot;.sldx&quot;    , S.append &quot;application/vnd.openxmlformats-officedocument&quot;
<span class="lineno">  171 </span>-- &gt;                           &quot;.presentationml.slide&quot;                         ),
<span class="lineno">  172 </span>-- &gt;   ( &quot;.spl&quot;     , &quot;application/futuresplash&quot;                               ),
<span class="lineno">  173 </span>-- &gt;   ( &quot;.svg&quot;     , &quot;image/svg+xml&quot;                                          ),
<span class="lineno">  174 </span>-- &gt;   ( &quot;.swf&quot;     , &quot;application/x-shockwave-flash&quot;                          ),
<span class="lineno">  175 </span>-- &gt;   ( &quot;.tar&quot;     , &quot;application/x-tar&quot;                                      ),
<span class="lineno">  176 </span>-- &gt;   ( &quot;.tar.bz2&quot; , &quot;application/x-bzip-compressed-tar&quot;                      ),
<span class="lineno">  177 </span>-- &gt;   ( &quot;.tar.gz&quot;  , &quot;application/x-tgz&quot;                                      ),
<span class="lineno">  178 </span>-- &gt;   ( &quot;.tbz&quot;     , &quot;application/x-bzip-compressed-tar&quot;                      ),
<span class="lineno">  179 </span>-- &gt;   ( &quot;.text&quot;    , &quot;text/plain&quot;                                             ),
<span class="lineno">  180 </span>-- &gt;   ( &quot;.tif&quot;     , &quot;image/tiff&quot;                                             ),
<span class="lineno">  181 </span>-- &gt;   ( &quot;.tiff&quot;    , &quot;image/tiff&quot;                                             ),
<span class="lineno">  182 </span>-- &gt;   ( &quot;.tgz&quot;     , &quot;application/x-tgz&quot;                                      ),
<span class="lineno">  183 </span>-- &gt;   ( &quot;.torrent&quot; , &quot;application/x-bittorrent&quot;                               ),
<span class="lineno">  184 </span>-- &gt;   ( &quot;.ts&quot;      , &quot;video/mp2t&quot;                                             ),
<span class="lineno">  185 </span>-- &gt;   ( &quot;.txt&quot;     , &quot;text/plain&quot;                                             ),
<span class="lineno">  186 </span>-- &gt;   ( &quot;.wav&quot;     , &quot;audio/x-wav&quot;                                            ),
<span class="lineno">  187 </span>-- &gt;   ( &quot;.wax&quot;     , &quot;audio/x-ms-wax&quot;                                         ),
<span class="lineno">  188 </span>-- &gt;   ( &quot;.webm&quot;    , &quot;video/webm&quot;                                             ),
<span class="lineno">  189 </span>-- &gt;   ( &quot;.wma&quot;     , &quot;audio/x-ms-wma&quot;                                         ),
<span class="lineno">  190 </span>-- &gt;   ( &quot;.wmv&quot;     , &quot;video/x-ms-wmv&quot;                                         ),
<span class="lineno">  191 </span>-- &gt;   ( &quot;.xbm&quot;     , &quot;image/x-xbitmap&quot;                                        ),
<span class="lineno">  192 </span>-- &gt;   ( &quot;.xlam&quot;    , &quot;application/vnd.ms-excel.addin.macroEnabled.12&quot;         ),
<span class="lineno">  193 </span>-- &gt;   ( &quot;.xls&quot;     , &quot;application/vnd.ms-excel&quot;                               ),
<span class="lineno">  194 </span>-- &gt;   ( &quot;.xlsb&quot;    , &quot;application/vnd.ms-excel.sheet.binary.macroEnabled.12&quot;  ),
<span class="lineno">  195 </span>-- &gt;   ( &quot;.xlsx&quot;    , S.append &quot;application/vnd.openxmlformats-officedocument.&quot;
<span class="lineno">  196 </span>-- &gt;                           &quot;spreadsheetml.sheet&quot;                           ),
<span class="lineno">  197 </span>-- &gt;   ( &quot;.xltx&quot;    , S.append &quot;application/vnd.openxmlformats-officedocument.&quot;
<span class="lineno">  198 </span>-- &gt;                           &quot;spreadsheetml.template&quot;                        ),
<span class="lineno">  199 </span>-- &gt;   ( &quot;.xml&quot;     , &quot;text/xml&quot;                                               ),
<span class="lineno">  200 </span>-- &gt;   ( &quot;.xpm&quot;     , &quot;image/x-xpixmap&quot;                                        ),
<span class="lineno">  201 </span>-- &gt;   ( &quot;.xwd&quot;     , &quot;image/x-xwindowdump&quot;                                    ),
<span class="lineno">  202 </span>-- &gt;   ( &quot;.zip&quot;     , &quot;application/zip&quot;                                        ) ]
<span class="lineno">  203 </span>
<span class="lineno">  204 </span>defaultMimeTypes :: MimeMap
<span class="lineno">  205 </span><span class="decl"><span class="istickedoff">defaultMimeTypes =</span>
<span class="lineno">  206 </span><span class="spaces">  </span><span class="istickedoff">Map.fromList [</span>
<span class="lineno">  207 </span><span class="spaces">    </span><span class="istickedoff">( &quot;.asc&quot;     , &quot;text/plain&quot;                                             ),</span>
<span class="lineno">  208 </span><span class="spaces">    </span><span class="istickedoff">( &quot;.asf&quot;     , &quot;video/x-ms-asf&quot;                                         ),</span>
<span class="lineno">  209 </span><span class="spaces">    </span><span class="istickedoff">( &quot;.asx&quot;     , &quot;video/x-ms-asf&quot;                                         ),</span>
<span class="lineno">  210 </span><span class="spaces">    </span><span class="istickedoff">( &quot;.au&quot;      , &quot;audio/basic&quot;                                            ),</span>
<span class="lineno">  211 </span><span class="spaces">    </span><span class="istickedoff">( &quot;.avi&quot;     , &quot;video/x-msvideo&quot;                                        ),</span>
<span class="lineno">  212 </span><span class="spaces">    </span><span class="istickedoff">( &quot;.bmp&quot;     , &quot;image/bmp&quot;                                              ),</span>
<span class="lineno">  213 </span><span class="spaces">    </span><span class="istickedoff">( &quot;.bz2&quot;     , &quot;application/x-bzip&quot;                                     ),</span>
<span class="lineno">  214 </span><span class="spaces">    </span><span class="istickedoff">( &quot;.c&quot;       , &quot;text/plain&quot;                                             ),</span>
<span class="lineno">  215 </span><span class="spaces">    </span><span class="istickedoff">( &quot;.class&quot;   , &quot;application/octet-stream&quot;                               ),</span>
<span class="lineno">  216 </span><span class="spaces">    </span><span class="istickedoff">( &quot;.conf&quot;    , &quot;text/plain&quot;                                             ),</span>
<span class="lineno">  217 </span><span class="spaces">    </span><span class="istickedoff">( &quot;.cpp&quot;     , &quot;text/plain&quot;                                             ),</span>
<span class="lineno">  218 </span><span class="spaces">    </span><span class="istickedoff">( &quot;.css&quot;     , &quot;text/css&quot;                                               ),</span>
<span class="lineno">  219 </span><span class="spaces">    </span><span class="istickedoff">( &quot;.cxx&quot;     , &quot;text/plain&quot;                                             ),</span>
<span class="lineno">  220 </span><span class="spaces">    </span><span class="istickedoff">( &quot;.doc&quot;     , &quot;application/msword&quot;                                     ),</span>
<span class="lineno">  221 </span><span class="spaces">    </span><span class="istickedoff">( &quot;.docx&quot;    , S.append &quot;application/vnd.openxmlformats-officedocument&quot;</span>
<span class="lineno">  222 </span><span class="spaces">                            </span><span class="istickedoff">&quot;.wordprocessingml.document&quot;                    ),</span>
<span class="lineno">  223 </span><span class="spaces">    </span><span class="istickedoff">( &quot;.dotx&quot;    , S.append &quot;application/vnd.openxmlformats-officedocument&quot;</span>
<span class="lineno">  224 </span><span class="spaces">                            </span><span class="istickedoff">&quot;.wordprocessingml.template&quot;                    ),</span>
<span class="lineno">  225 </span><span class="spaces">    </span><span class="istickedoff">( &quot;.dtd&quot;     , &quot;application/xml-dtd&quot;                                    ),</span>
<span class="lineno">  226 </span><span class="spaces">    </span><span class="istickedoff">( &quot;.dvi&quot;     , &quot;application/x-dvi&quot;                                      ),</span>
<span class="lineno">  227 </span><span class="spaces">    </span><span class="istickedoff">( &quot;.exe&quot;     , &quot;application/octet-stream&quot;                               ),</span>
<span class="lineno">  228 </span><span class="spaces">    </span><span class="istickedoff">( &quot;.flv&quot;     , &quot;video/x-flv&quot;                                            ),</span>
<span class="lineno">  229 </span><span class="spaces">    </span><span class="istickedoff">( &quot;.gif&quot;     , &quot;image/gif&quot;                                              ),</span>
<span class="lineno">  230 </span><span class="spaces">    </span><span class="istickedoff">( &quot;.gz&quot;      , &quot;application/x-gzip&quot;                                     ),</span>
<span class="lineno">  231 </span><span class="spaces">    </span><span class="istickedoff">( &quot;.hs&quot;      , &quot;text/plain&quot;                                             ),</span>
<span class="lineno">  232 </span><span class="spaces">    </span><span class="istickedoff">( &quot;.htm&quot;     , &quot;text/html&quot;                                              ),</span>
<span class="lineno">  233 </span><span class="spaces">    </span><span class="istickedoff">( &quot;.html&quot;    , &quot;text/html&quot;                                              ),</span>
<span class="lineno">  234 </span><span class="spaces">    </span><span class="istickedoff">( &quot;.ico&quot;     , &quot;image/x-icon&quot;                                           ),</span>
<span class="lineno">  235 </span><span class="spaces">    </span><span class="istickedoff">( &quot;.jar&quot;     , &quot;application/x-java-archive&quot;                             ),</span>
<span class="lineno">  236 </span><span class="spaces">    </span><span class="istickedoff">( &quot;.jpeg&quot;    , &quot;image/jpeg&quot;                                             ),</span>
<span class="lineno">  237 </span><span class="spaces">    </span><span class="istickedoff">( &quot;.jpg&quot;     , &quot;image/jpeg&quot;                                             ),</span>
<span class="lineno">  238 </span><span class="spaces">    </span><span class="istickedoff">( &quot;.js&quot;      , &quot;text/javascript&quot;                                        ),</span>
<span class="lineno">  239 </span><span class="spaces">    </span><span class="istickedoff">( &quot;.json&quot;    , &quot;application/json&quot;                                       ),</span>
<span class="lineno">  240 </span><span class="spaces">    </span><span class="istickedoff">( &quot;.log&quot;     , &quot;text/plain&quot;                                             ),</span>
<span class="lineno">  241 </span><span class="spaces">    </span><span class="istickedoff">( &quot;.m3u&quot;     , &quot;audio/x-mpegurl&quot;                                        ),</span>
<span class="lineno">  242 </span><span class="spaces">    </span><span class="istickedoff">( &quot;.m3u8&quot;    , &quot;application/x-mpegURL&quot;                                  ),</span>
<span class="lineno">  243 </span><span class="spaces">    </span><span class="istickedoff">( &quot;.mka&quot;     , &quot;audio/x-matroska&quot;                                       ),</span>
<span class="lineno">  244 </span><span class="spaces">    </span><span class="istickedoff">( &quot;.mk3d&quot;    , &quot;video/x-matroska&quot;                                       ),</span>
<span class="lineno">  245 </span><span class="spaces">    </span><span class="istickedoff">( &quot;.mkv&quot;     , &quot;video/x-matroska&quot;                                       ),</span>
<span class="lineno">  246 </span><span class="spaces">    </span><span class="istickedoff">( &quot;.mov&quot;     , &quot;video/quicktime&quot;                                        ),</span>
<span class="lineno">  247 </span><span class="spaces">    </span><span class="istickedoff">( &quot;.mp3&quot;     , &quot;audio/mpeg&quot;                                             ),</span>
<span class="lineno">  248 </span><span class="spaces">    </span><span class="istickedoff">( &quot;.mp4&quot;     , &quot;video/mp4&quot;                                              ),</span>
<span class="lineno">  249 </span><span class="spaces">    </span><span class="istickedoff">( &quot;.mpeg&quot;    , &quot;video/mpeg&quot;                                             ),</span>
<span class="lineno">  250 </span><span class="spaces">    </span><span class="istickedoff">( &quot;.mpg&quot;     , &quot;video/mpeg&quot;                                             ),</span>
<span class="lineno">  251 </span><span class="spaces">    </span><span class="istickedoff">( &quot;.ogg&quot;     , &quot;application/ogg&quot;                                        ),</span>
<span class="lineno">  252 </span><span class="spaces">    </span><span class="istickedoff">( &quot;.pac&quot;     , &quot;application/x-ns-proxy-autoconfig&quot;                      ),</span>
<span class="lineno">  253 </span><span class="spaces">    </span><span class="istickedoff">( &quot;.pdf&quot;     , &quot;application/pdf&quot;                                        ),</span>
<span class="lineno">  254 </span><span class="spaces">    </span><span class="istickedoff">( &quot;.png&quot;     , &quot;image/png&quot;                                              ),</span>
<span class="lineno">  255 </span><span class="spaces">    </span><span class="istickedoff">( &quot;.potx&quot;    , S.append &quot;application/vnd.openxmlformats-officedocument&quot;</span>
<span class="lineno">  256 </span><span class="spaces">                            </span><span class="istickedoff">&quot;.presentationml.template&quot;                      ),</span>
<span class="lineno">  257 </span><span class="spaces">    </span><span class="istickedoff">( &quot;.ppsx&quot;    , S.append &quot;application/vnd.openxmlformats-officedocument&quot;</span>
<span class="lineno">  258 </span><span class="spaces">                            </span><span class="istickedoff">&quot;.presentationml.slideshow&quot;                     ),</span>
<span class="lineno">  259 </span><span class="spaces">    </span><span class="istickedoff">( &quot;.ppt&quot;     , &quot;application/vnd.ms-powerpoint&quot;                          ),</span>
<span class="lineno">  260 </span><span class="spaces">    </span><span class="istickedoff">( &quot;.pptx&quot;    , S.append &quot;application/vnd.openxmlformats-officedocument&quot;</span>
<span class="lineno">  261 </span><span class="spaces">                            </span><span class="istickedoff">&quot;.presentationml.presentation&quot;                  ),</span>
<span class="lineno">  262 </span><span class="spaces">    </span><span class="istickedoff">( &quot;.ps&quot;      , &quot;application/postscript&quot;                                 ),</span>
<span class="lineno">  263 </span><span class="spaces">    </span><span class="istickedoff">( &quot;.qt&quot;      , &quot;video/quicktime&quot;                                        ),</span>
<span class="lineno">  264 </span><span class="spaces">    </span><span class="istickedoff">( &quot;.rtf&quot;     , &quot;text/rtf&quot;                                               ),</span>
<span class="lineno">  265 </span><span class="spaces">    </span><span class="istickedoff">( &quot;.sig&quot;     , &quot;application/pgp-signature&quot;                              ),</span>
<span class="lineno">  266 </span><span class="spaces">    </span><span class="istickedoff">( &quot;.sldx&quot;    , S.append &quot;application/vnd.openxmlformats-officedocument&quot;</span>
<span class="lineno">  267 </span><span class="spaces">                            </span><span class="istickedoff">&quot;.presentationml.slide&quot;                         ),</span>
<span class="lineno">  268 </span><span class="spaces">    </span><span class="istickedoff">( &quot;.spl&quot;     , &quot;application/futuresplash&quot;                               ),</span>
<span class="lineno">  269 </span><span class="spaces">    </span><span class="istickedoff">( &quot;.svg&quot;     , &quot;image/svg+xml&quot;                                          ),</span>
<span class="lineno">  270 </span><span class="spaces">    </span><span class="istickedoff">( &quot;.swf&quot;     , &quot;application/x-shockwave-flash&quot;                          ),</span>
<span class="lineno">  271 </span><span class="spaces">    </span><span class="istickedoff">( &quot;.tar&quot;     , &quot;application/x-tar&quot;                                      ),</span>
<span class="lineno">  272 </span><span class="spaces">    </span><span class="istickedoff">( &quot;.tar.bz2&quot; , &quot;application/x-bzip-compressed-tar&quot;                      ),</span>
<span class="lineno">  273 </span><span class="spaces">    </span><span class="istickedoff">( &quot;.tar.gz&quot;  , &quot;application/x-tgz&quot;                                      ),</span>
<span class="lineno">  274 </span><span class="spaces">    </span><span class="istickedoff">( &quot;.tbz&quot;     , &quot;application/x-bzip-compressed-tar&quot;                      ),</span>
<span class="lineno">  275 </span><span class="spaces">    </span><span class="istickedoff">( &quot;.text&quot;    , &quot;text/plain&quot;                                             ),</span>
<span class="lineno">  276 </span><span class="spaces">    </span><span class="istickedoff">( &quot;.tif&quot;     , &quot;image/tiff&quot;                                             ),</span>
<span class="lineno">  277 </span><span class="spaces">    </span><span class="istickedoff">( &quot;.tiff&quot;    , &quot;image/tiff&quot;                                             ),</span>
<span class="lineno">  278 </span><span class="spaces">    </span><span class="istickedoff">( &quot;.tgz&quot;     , &quot;application/x-tgz&quot;                                      ),</span>
<span class="lineno">  279 </span><span class="spaces">    </span><span class="istickedoff">( &quot;.torrent&quot; , &quot;application/x-bittorrent&quot;                               ),</span>
<span class="lineno">  280 </span><span class="spaces">    </span><span class="istickedoff">( &quot;.ts&quot;      , &quot;video/mp2t&quot;                                             ),</span>
<span class="lineno">  281 </span><span class="spaces">    </span><span class="istickedoff">( &quot;.txt&quot;     , &quot;text/plain&quot;                                             ),</span>
<span class="lineno">  282 </span><span class="spaces">    </span><span class="istickedoff">( &quot;.wav&quot;     , &quot;audio/x-wav&quot;                                            ),</span>
<span class="lineno">  283 </span><span class="spaces">    </span><span class="istickedoff">( &quot;.wax&quot;     , &quot;audio/x-ms-wax&quot;                                         ),</span>
<span class="lineno">  284 </span><span class="spaces">    </span><span class="istickedoff">( &quot;.webm&quot;    , &quot;video/webm&quot;                                             ),</span>
<span class="lineno">  285 </span><span class="spaces">    </span><span class="istickedoff">( &quot;.wma&quot;     , &quot;audio/x-ms-wma&quot;                                         ),</span>
<span class="lineno">  286 </span><span class="spaces">    </span><span class="istickedoff">( &quot;.wmv&quot;     , &quot;video/x-ms-wmv&quot;                                         ),</span>
<span class="lineno">  287 </span><span class="spaces">    </span><span class="istickedoff">( &quot;.xbm&quot;     , &quot;image/x-xbitmap&quot;                                        ),</span>
<span class="lineno">  288 </span><span class="spaces">    </span><span class="istickedoff">( &quot;.xlam&quot;    , &quot;application/vnd.ms-excel.addin.macroEnabled.12&quot;         ),</span>
<span class="lineno">  289 </span><span class="spaces">    </span><span class="istickedoff">( &quot;.xls&quot;     , &quot;application/vnd.ms-excel&quot;                               ),</span>
<span class="lineno">  290 </span><span class="spaces">    </span><span class="istickedoff">( &quot;.xlsb&quot;    , &quot;application/vnd.ms-excel.sheet.binary.macroEnabled.12&quot;  ),</span>
<span class="lineno">  291 </span><span class="spaces">    </span><span class="istickedoff">( &quot;.xlsx&quot;    , S.append &quot;application/vnd.openxmlformats-officedocument.&quot;</span>
<span class="lineno">  292 </span><span class="spaces">                            </span><span class="istickedoff">&quot;spreadsheetml.sheet&quot;                           ),</span>
<span class="lineno">  293 </span><span class="spaces">    </span><span class="istickedoff">( &quot;.xltx&quot;    , S.append &quot;application/vnd.openxmlformats-officedocument.&quot;</span>
<span class="lineno">  294 </span><span class="spaces">                            </span><span class="istickedoff">&quot;spreadsheetml.template&quot;                        ),</span>
<span class="lineno">  295 </span><span class="spaces">    </span><span class="istickedoff">( &quot;.xml&quot;     , &quot;text/xml&quot;                                               ),</span>
<span class="lineno">  296 </span><span class="spaces">    </span><span class="istickedoff">( &quot;.xpm&quot;     , &quot;image/x-xpixmap&quot;                                        ),</span>
<span class="lineno">  297 </span><span class="spaces">    </span><span class="istickedoff">( &quot;.xwd&quot;     , &quot;image/x-xwindowdump&quot;                                    ),</span>
<span class="lineno">  298 </span><span class="spaces">    </span><span class="istickedoff">( &quot;.zip&quot;     , &quot;application/zip&quot;                                        ) ]</span></span>
<span class="lineno">  299 </span>
<span class="lineno">  300 </span>
<span class="lineno">  301 </span>------------------------------------------------------------------------------
<span class="lineno">  302 </span>-- | A collection of options for serving static files out of a directory.
<span class="lineno">  303 </span>data DirectoryConfig m = DirectoryConfig {
<span class="lineno">  304 </span>    -- | Files to look for when a directory is requested (e.g., index.html)
<span class="lineno">  305 </span>    indexFiles      :: [FilePath],
<span class="lineno">  306 </span>
<span class="lineno">  307 </span>    -- | Handler to generate a directory listing if there is no index.
<span class="lineno">  308 </span>    indexGenerator  :: FilePath -&gt; m (),
<span class="lineno">  309 </span>
<span class="lineno">  310 </span>    -- | Map of extensions to pass to dynamic file handlers.  This could be
<span class="lineno">  311 </span>    -- used, for example, to implement CGI dispatch, pretty printing of source
<span class="lineno">  312 </span>    -- code, etc.
<span class="lineno">  313 </span>    dynamicHandlers :: HandlerMap m,
<span class="lineno">  314 </span>
<span class="lineno">  315 </span>    -- | MIME type map to look up content types.
<span class="lineno">  316 </span>    mimeTypes       :: MimeMap,
<span class="lineno">  317 </span>
<span class="lineno">  318 </span>    -- | Handler that is called before a file is served.  It will only be
<span class="lineno">  319 </span>    -- called when a file is actually found, not for generated index pages.
<span class="lineno">  320 </span>    preServeHook    :: FilePath -&gt; m ()
<span class="lineno">  321 </span>    }
<span class="lineno">  322 </span>
<span class="lineno">  323 </span>
<span class="lineno">  324 </span>------------------------------------------------------------------------------
<span class="lineno">  325 </span>-- | Style information for the default directory index generator.
<span class="lineno">  326 </span>snapIndexStyles :: ByteString
<span class="lineno">  327 </span><span class="decl"><span class="istickedoff">snapIndexStyles =</span>
<span class="lineno">  328 </span><span class="spaces">    </span><span class="istickedoff">S.intercalate &quot;\n&quot;</span>
<span class="lineno">  329 </span><span class="spaces">        </span><span class="istickedoff">[ &quot;body { margin: 0px 0px 0px 0px; font-family: sans-serif }&quot;</span>
<span class="lineno">  330 </span><span class="spaces">        </span><span class="istickedoff">, &quot;div.header {&quot;</span>
<span class="lineno">  331 </span><span class="spaces">        </span><span class="istickedoff">,     &quot;padding: 40px 40px 0px 40px; height:35px;&quot;</span>
<span class="lineno">  332 </span><span class="spaces">        </span><span class="istickedoff">,     &quot;background:rgb(25,50,87);&quot;</span>
<span class="lineno">  333 </span><span class="spaces">        </span><span class="istickedoff">,     &quot;background-image:-webkit-gradient(&quot;</span>
<span class="lineno">  334 </span><span class="spaces">        </span><span class="istickedoff">,         &quot;linear,left bottom,left top,&quot;</span>
<span class="lineno">  335 </span><span class="spaces">        </span><span class="istickedoff">,         &quot;color-stop(0.00, rgb(31,62,108)),&quot;</span>
<span class="lineno">  336 </span><span class="spaces">        </span><span class="istickedoff">,         &quot;color-stop(1.00, rgb(19,38,66)));&quot;</span>
<span class="lineno">  337 </span><span class="spaces">        </span><span class="istickedoff">,     &quot;background-image:-moz-linear-gradient(&quot;</span>
<span class="lineno">  338 </span><span class="spaces">        </span><span class="istickedoff">,         &quot;center bottom,rgb(31,62,108) 0%,rgb(19,38,66) 100%);&quot;</span>
<span class="lineno">  339 </span><span class="spaces">        </span><span class="istickedoff">,     &quot;text-shadow:-1px 3px 1px rgb(16,33,57);&quot;</span>
<span class="lineno">  340 </span><span class="spaces">        </span><span class="istickedoff">,     &quot;font-size:16pt; letter-spacing: 2pt; color:white;&quot;</span>
<span class="lineno">  341 </span><span class="spaces">        </span><span class="istickedoff">,     &quot;border-bottom:10px solid rgb(46,93,156) }&quot;</span>
<span class="lineno">  342 </span><span class="spaces">        </span><span class="istickedoff">, &quot;div.content {&quot;</span>
<span class="lineno">  343 </span><span class="spaces">        </span><span class="istickedoff">,     &quot;background:rgb(255,255,255);&quot;</span>
<span class="lineno">  344 </span><span class="spaces">        </span><span class="istickedoff">,     &quot;background-image:-webkit-gradient(&quot;</span>
<span class="lineno">  345 </span><span class="spaces">        </span><span class="istickedoff">,         &quot;linear,left bottom, left top,&quot;</span>
<span class="lineno">  346 </span><span class="spaces">        </span><span class="istickedoff">,         &quot;color-stop(0.50, rgb(255,255,255)),&quot;</span>
<span class="lineno">  347 </span><span class="spaces">        </span><span class="istickedoff">,         &quot;color-stop(1.00, rgb(224,234,247)));&quot;</span>
<span class="lineno">  348 </span><span class="spaces">        </span><span class="istickedoff">,     &quot;background-image:-moz-linear-gradient(&quot;</span>
<span class="lineno">  349 </span><span class="spaces">        </span><span class="istickedoff">,         &quot;center bottom, white 50%, rgb(224,234,247) 100%);&quot;</span>
<span class="lineno">  350 </span><span class="spaces">        </span><span class="istickedoff">,     &quot;padding: 40px 40px 40px 40px }&quot;</span>
<span class="lineno">  351 </span><span class="spaces">        </span><span class="istickedoff">, &quot;div.footer {&quot;</span>
<span class="lineno">  352 </span><span class="spaces">        </span><span class="istickedoff">,     &quot;padding: 16px 0px 10px 10px; height:31px;&quot;</span>
<span class="lineno">  353 </span><span class="spaces">        </span><span class="istickedoff">,     &quot;border-top: 1px solid rgb(194,209,225);&quot;</span>
<span class="lineno">  354 </span><span class="spaces">        </span><span class="istickedoff">,     &quot;color: rgb(160,172,186); font-size:10pt;&quot;</span>
<span class="lineno">  355 </span><span class="spaces">        </span><span class="istickedoff">,     &quot;background: rgb(245,249,255) }&quot;</span>
<span class="lineno">  356 </span><span class="spaces">        </span><span class="istickedoff">, &quot;table { max-width:100%; margin: 0 auto;&quot; `S.append`</span>
<span class="lineno">  357 </span><span class="spaces">          </span><span class="istickedoff">&quot; border-collapse: collapse; }&quot;</span>
<span class="lineno">  358 </span><span class="spaces">        </span><span class="istickedoff">, &quot;tr:hover { background:rgb(256,256,224) }&quot;</span>
<span class="lineno">  359 </span><span class="spaces">        </span><span class="istickedoff">, &quot;td { border:0; font-family:monospace; padding: 2px 0; }&quot;</span>
<span class="lineno">  360 </span><span class="spaces">        </span><span class="istickedoff">, &quot;td.filename, td.type { padding-right: 2em; }&quot;</span>
<span class="lineno">  361 </span><span class="spaces">        </span><span class="istickedoff">, &quot;th { border:0; background:rgb(28,56,97);&quot;</span>
<span class="lineno">  362 </span><span class="spaces">        </span><span class="istickedoff">,      &quot;text-shadow:-1px 3px 1px rgb(16,33,57); color: white}&quot;</span>
<span class="lineno">  363 </span><span class="spaces">        </span><span class="istickedoff">]</span></span>
<span class="lineno">  364 </span>
<span class="lineno">  365 </span>
<span class="lineno">  366 </span>------------------------------------------------------------------------------
<span class="lineno">  367 </span>-- | An automatic index generator, which is fairly small and does not rely on
<span class="lineno">  368 </span>-- any external files (which may not be there depending on external request
<span class="lineno">  369 </span>-- routing).
<span class="lineno">  370 </span>--
<span class="lineno">  371 </span>-- A 'MimeMap' is passed in to display the types of files in the directory
<span class="lineno">  372 </span>-- listing based on their extension.  Preferably, this is the same as the map
<span class="lineno">  373 </span>-- in the 'DirectoryConfig'
<span class="lineno">  374 </span>--
<span class="lineno">  375 </span>-- The styles parameter allows you to apply styles to the directory listing.
<span class="lineno">  376 </span>-- The listing itself consists of a table, containing a header row using
<span class="lineno">  377 </span>-- th elements, and one row per file using td elements, so styles for those
<span class="lineno">  378 </span>-- pieces may be attached to the appropriate tags.
<span class="lineno">  379 </span>defaultIndexGenerator :: MonadSnap m
<span class="lineno">  380 </span>                      =&gt; MimeMap    -- ^ MIME type mapping for reporting types
<span class="lineno">  381 </span>                      -&gt; ByteString -- ^ Style info to insert in header
<span class="lineno">  382 </span>                      -&gt; FilePath   -- ^ Directory to generate index for
<span class="lineno">  383 </span>                      -&gt; m ()
<span class="lineno">  384 </span><span class="decl"><span class="istickedoff">defaultIndexGenerator mm styles d = do</span>
<span class="lineno">  385 </span><span class="spaces">    </span><span class="istickedoff">modifyResponse $ setContentType &quot;text/html; charset=utf-8&quot;</span>
<span class="lineno">  386 </span><span class="spaces">    </span><span class="istickedoff">rq      &lt;- getRequest</span>
<span class="lineno">  387 </span><span class="spaces"></span><span class="istickedoff"></span>
<span class="lineno">  388 </span><span class="spaces">    </span><span class="istickedoff">let uri   = uriWithoutQueryString rq</span>
<span class="lineno">  389 </span><span class="spaces">    </span><span class="istickedoff">let pInfo = rqPathInfo rq</span>
<span class="lineno">  390 </span><span class="spaces"></span><span class="istickedoff"></span>
<span class="lineno">  391 </span><span class="spaces">    </span><span class="istickedoff">writeBS &quot;&lt;!DOCTYPE html&gt;\n&lt;html&gt;\n&lt;head&gt;&quot;</span>
<span class="lineno">  392 </span><span class="spaces">    </span><span class="istickedoff">writeBS &quot;&lt;title&gt;Directory Listing: &quot;</span>
<span class="lineno">  393 </span><span class="spaces">    </span><span class="istickedoff">writeBS uri</span>
<span class="lineno">  394 </span><span class="spaces">    </span><span class="istickedoff">writeBS &quot;&lt;/title&gt;&quot;</span>
<span class="lineno">  395 </span><span class="spaces">    </span><span class="istickedoff">writeBS &quot;&lt;style type='text/css'&gt;&quot;</span>
<span class="lineno">  396 </span><span class="spaces">    </span><span class="istickedoff">writeBS styles</span>
<span class="lineno">  397 </span><span class="spaces">    </span><span class="istickedoff">writeBS &quot;&lt;/style&gt;&lt;/head&gt;&lt;body&gt;&quot;</span>
<span class="lineno">  398 </span><span class="spaces">    </span><span class="istickedoff">writeBS &quot;&lt;div class=\&quot;header\&quot;&gt;Directory Listing: &quot;</span>
<span class="lineno">  399 </span><span class="spaces">    </span><span class="istickedoff">writeBS uri</span>
<span class="lineno">  400 </span><span class="spaces">    </span><span class="istickedoff">writeBS &quot;&lt;/div&gt;&lt;div class=\&quot;content\&quot;&gt;&quot;</span>
<span class="lineno">  401 </span><span class="spaces">    </span><span class="istickedoff">writeBS &quot;&lt;table&gt;&lt;tr&gt;&lt;th&gt;File Name&lt;/th&gt;&lt;th&gt;Type&lt;/th&gt;&lt;th&gt;Last Modified&quot;</span>
<span class="lineno">  402 </span><span class="spaces">    </span><span class="istickedoff">writeBS &quot;&lt;/th&gt;&lt;/tr&gt;&quot;</span>
<span class="lineno">  403 </span><span class="spaces"></span><span class="istickedoff"></span>
<span class="lineno">  404 </span><span class="spaces">    </span><span class="istickedoff">when (pInfo /= &quot;&quot;) $</span>
<span class="lineno">  405 </span><span class="spaces">        </span><span class="istickedoff">writeBS &quot;&lt;tr&gt;&lt;td&gt;&lt;a href='../'&gt;..&lt;/a&gt;&lt;/td&gt;&lt;td colspan=2&gt;DIR&lt;/td&gt;&lt;/tr&gt;&quot;</span>
<span class="lineno">  406 </span><span class="spaces"></span><span class="istickedoff"></span>
<span class="lineno">  407 </span><span class="spaces">    </span><span class="istickedoff">entries &lt;- liftIO $ getDirectoryContents d</span>
<span class="lineno">  408 </span><span class="spaces">    </span><span class="istickedoff">dirs    &lt;- liftIO $ filterM (doesDirectoryExist . (d &lt;/&gt;)) entries</span>
<span class="lineno">  409 </span><span class="spaces">    </span><span class="istickedoff">files   &lt;- liftIO $ filterM (doesFileExist . (d &lt;/&gt;)) entries</span>
<span class="lineno">  410 </span><span class="spaces"></span><span class="istickedoff"></span>
<span class="lineno">  411 </span><span class="spaces">    </span><span class="istickedoff">forM_ (sort $ filter (not . (`elem` [&quot;..&quot;, &quot;.&quot;])) dirs) $ \f0 -&gt; do</span>
<span class="lineno">  412 </span><span class="spaces">        </span><span class="istickedoff">f &lt;- liftIO $ liftM (\s -&gt; T.encodeUtf8 s `mappend` &quot;/&quot;)</span>
<span class="lineno">  413 </span><span class="spaces">                    </span><span class="istickedoff">$ decodeFilePath f0</span>
<span class="lineno">  414 </span><span class="spaces">        </span><span class="istickedoff">writeBS &quot;&lt;tr&gt;&lt;td class='filename'&gt;&lt;a href='&quot;</span>
<span class="lineno">  415 </span><span class="spaces">        </span><span class="istickedoff">writeBS f</span>
<span class="lineno">  416 </span><span class="spaces">        </span><span class="istickedoff">writeBS &quot;'&gt;&quot;</span>
<span class="lineno">  417 </span><span class="spaces">        </span><span class="istickedoff">writeBS f</span>
<span class="lineno">  418 </span><span class="spaces">        </span><span class="istickedoff">writeBS &quot;&lt;/a&gt;&lt;/td&gt;&lt;td class='type' colspan=2&gt;DIR&lt;/td&gt;&lt;/tr&gt;&quot;</span>
<span class="lineno">  419 </span><span class="spaces"></span><span class="istickedoff"></span>
<span class="lineno">  420 </span><span class="spaces">    </span><span class="istickedoff">forM_ (sort files) $ \f0 -&gt; do</span>
<span class="lineno">  421 </span><span class="spaces">        </span><span class="istickedoff">f &lt;- liftIO $ liftM T.encodeUtf8 $ decodeFilePath f0</span>
<span class="lineno">  422 </span><span class="spaces">        </span><span class="istickedoff">stat &lt;- liftIO $ getFileStatus (d &lt;/&gt; f0)</span>
<span class="lineno">  423 </span><span class="spaces">        </span><span class="istickedoff">tm   &lt;- liftIO $ formatHttpTime (modificationTime stat)</span>
<span class="lineno">  424 </span><span class="spaces">        </span><span class="istickedoff">writeBS &quot;&lt;tr&gt;&lt;td class='filename'&gt;&lt;a href='&quot;</span>
<span class="lineno">  425 </span><span class="spaces">        </span><span class="istickedoff">writeBS f</span>
<span class="lineno">  426 </span><span class="spaces">        </span><span class="istickedoff">writeBS &quot;'&gt;&quot;</span>
<span class="lineno">  427 </span><span class="spaces">        </span><span class="istickedoff">writeBS f</span>
<span class="lineno">  428 </span><span class="spaces">        </span><span class="istickedoff">writeBS &quot;&lt;/a&gt;&lt;/td&gt;&lt;td class='type'&gt;&quot;</span>
<span class="lineno">  429 </span><span class="spaces">        </span><span class="istickedoff">writeBS (fileType mm f0)</span>
<span class="lineno">  430 </span><span class="spaces">        </span><span class="istickedoff">writeBS &quot;&lt;/td&gt;&lt;td&gt;&quot;</span>
<span class="lineno">  431 </span><span class="spaces">        </span><span class="istickedoff">writeBS tm</span>
<span class="lineno">  432 </span><span class="spaces">        </span><span class="istickedoff">writeBS &quot;&lt;/tr&gt;&quot;</span>
<span class="lineno">  433 </span><span class="spaces"></span><span class="istickedoff"></span>
<span class="lineno">  434 </span><span class="spaces">    </span><span class="istickedoff">writeBS &quot;&lt;/table&gt;&lt;/div&gt;&lt;div class=\&quot;footer\&quot;&gt;Powered by &quot;</span>
<span class="lineno">  435 </span><span class="spaces">    </span><span class="istickedoff">writeBS &quot;&lt;b&gt;&lt;a href=\&quot;http://snapframework.com/\&quot;&gt;Snap&lt;/a&gt;&lt;/b&gt;&lt;/div&gt;&quot;</span>
<span class="lineno">  436 </span><span class="spaces">    </span><span class="istickedoff">writeBS &quot;&lt;/body&gt;&quot;</span></span>
<span class="lineno">  437 </span>
<span class="lineno">  438 </span>
<span class="lineno">  439 </span>------------------------------------------------------------------------------
<span class="lineno">  440 </span>decodeFilePath :: FilePath -&gt; IO T.Text
<span class="lineno">  441 </span><span class="decl"><span class="istickedoff">decodeFilePath fp = do</span>
<span class="lineno">  442 </span><span class="spaces">    </span><span class="istickedoff">evaluate (T.decodeUtf8 bs) `catch`</span>
<span class="lineno">  443 </span><span class="spaces">        </span><span class="istickedoff">(\(_::SomeException) -&gt; return (T.pack fp))</span>
<span class="lineno">  444 </span><span class="spaces">  </span><span class="istickedoff">where</span>
<span class="lineno">  445 </span><span class="spaces">    </span><span class="istickedoff">bs = S.pack fp</span></span>
<span class="lineno">  446 </span>
<span class="lineno">  447 </span>------------------------------------------------------------------------------
<span class="lineno">  448 </span>-- | A very simple configuration for directory serving.  This configuration
<span class="lineno">  449 </span>-- uses built-in MIME types from 'defaultMimeTypes', and has no index files,
<span class="lineno">  450 </span>-- index generator, dynamic file handlers, or 'preServeHook'.
<span class="lineno">  451 </span>simpleDirectoryConfig :: MonadSnap m =&gt; DirectoryConfig m
<span class="lineno">  452 </span><span class="decl"><span class="istickedoff">simpleDirectoryConfig = DirectoryConfig {</span>
<span class="lineno">  453 </span><span class="spaces">    </span><span class="istickedoff">indexFiles      = [],</span>
<span class="lineno">  454 </span><span class="spaces">    </span><span class="istickedoff">indexGenerator  = const pass,</span>
<span class="lineno">  455 </span><span class="spaces">    </span><span class="istickedoff">dynamicHandlers = Map.empty,</span>
<span class="lineno">  456 </span><span class="spaces">    </span><span class="istickedoff">mimeTypes       = defaultMimeTypes,</span>
<span class="lineno">  457 </span><span class="spaces">    </span><span class="istickedoff">preServeHook    = const $ return $! ()</span>
<span class="lineno">  458 </span><span class="spaces">    </span><span class="istickedoff">}</span></span>
<span class="lineno">  459 </span>
<span class="lineno">  460 </span>
<span class="lineno">  461 </span>------------------------------------------------------------------------------
<span class="lineno">  462 </span>-- | A reasonable default configuration for directory serving.  This
<span class="lineno">  463 </span>-- configuration uses built-in MIME types from 'defaultMimeTypes', serves
<span class="lineno">  464 </span>-- common index files @index.html@ and @index.htm@, but does not autogenerate
<span class="lineno">  465 </span>-- directory indexes, nor have any dynamic file handlers. The 'preServeHook'
<span class="lineno">  466 </span>-- will not do anything.
<span class="lineno">  467 </span>defaultDirectoryConfig :: MonadSnap m =&gt; DirectoryConfig m
<span class="lineno">  468 </span><span class="decl"><span class="istickedoff">defaultDirectoryConfig = DirectoryConfig {</span>
<span class="lineno">  469 </span><span class="spaces">    </span><span class="istickedoff">indexFiles      = [&quot;index.html&quot;, &quot;index.htm&quot;],</span>
<span class="lineno">  470 </span><span class="spaces">    </span><span class="istickedoff">indexGenerator  = const pass,</span>
<span class="lineno">  471 </span><span class="spaces">    </span><span class="istickedoff">dynamicHandlers = Map.empty,</span>
<span class="lineno">  472 </span><span class="spaces">    </span><span class="istickedoff">mimeTypes       = defaultMimeTypes,</span>
<span class="lineno">  473 </span><span class="spaces">    </span><span class="istickedoff">preServeHook    = const $ return $! ()</span>
<span class="lineno">  474 </span><span class="spaces">    </span><span class="istickedoff">}</span></span>
<span class="lineno">  475 </span>
<span class="lineno">  476 </span>
<span class="lineno">  477 </span>------------------------------------------------------------------------------
<span class="lineno">  478 </span>-- | A more elaborate configuration for file serving.  This configuration
<span class="lineno">  479 </span>-- uses built-in MIME types from 'defaultMimeTypes', serves common index files
<span class="lineno">  480 </span>-- @index.html@ and @index.htm@, and autogenerates directory indexes with a
<span class="lineno">  481 </span>-- Snap-like feel.  It still has no dynamic file handlers, nor 'preServeHook',
<span class="lineno">  482 </span>-- which should be added as needed.
<span class="lineno">  483 </span>--
<span class="lineno">  484 </span>-- Files recognized as indexes include @index.html@, @index.htm@,
<span class="lineno">  485 </span>-- @default.html@, @default.htm@, @home.html@
<span class="lineno">  486 </span>--
<span class="lineno">  487 </span>-- Example of how the autogenerated directory index looks like:
<span class="lineno">  488 </span>--
<span class="lineno">  489 </span>-- &lt;&lt;data:image/png;base64,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&gt;&gt;
<span class="lineno">  490 </span>
<span class="lineno">  491 </span>fancyDirectoryConfig :: MonadSnap m =&gt; DirectoryConfig m
<span class="lineno">  492 </span><span class="decl"><span class="istickedoff">fancyDirectoryConfig = DirectoryConfig {</span>
<span class="lineno">  493 </span><span class="spaces">    </span><span class="istickedoff">indexFiles      = [&quot;index.html&quot;, &quot;index.htm&quot;],</span>
<span class="lineno">  494 </span><span class="spaces">    </span><span class="istickedoff">indexGenerator  = defaultIndexGenerator defaultMimeTypes snapIndexStyles,</span>
<span class="lineno">  495 </span><span class="spaces">    </span><span class="istickedoff">dynamicHandlers = Map.empty,</span>
<span class="lineno">  496 </span><span class="spaces">    </span><span class="istickedoff">mimeTypes       = defaultMimeTypes,</span>
<span class="lineno">  497 </span><span class="spaces">    </span><span class="istickedoff">preServeHook    = const $ return $! ()</span>
<span class="lineno">  498 </span><span class="spaces">    </span><span class="istickedoff">}</span></span>
<span class="lineno">  499 </span>
<span class="lineno">  500 </span>
<span class="lineno">  501 </span>------------------------------------------------------------------------------
<span class="lineno">  502 </span>-- | Serves static files from a directory using the default configuration
<span class="lineno">  503 </span>-- as given in 'defaultDirectoryConfig'.
<span class="lineno">  504 </span>serveDirectory :: MonadSnap m
<span class="lineno">  505 </span>               =&gt; FilePath           -- ^ Directory to serve from
<span class="lineno">  506 </span>               -&gt; m ()
<span class="lineno">  507 </span><span class="decl"><span class="istickedoff">serveDirectory = serveDirectoryWith defaultDirectoryConfig</span></span>
<span class="lineno">  508 </span>{-# INLINE serveDirectory #-}
<span class="lineno">  509 </span>
<span class="lineno">  510 </span>
<span class="lineno">  511 </span>------------------------------------------------------------------------------
<span class="lineno">  512 </span>-- | Serves static files from a directory.  Configuration options are
<span class="lineno">  513 </span>-- passed in a 'DirectoryConfig' that captures various choices about desired
<span class="lineno">  514 </span>-- behavior.  The relative path given in 'rqPathInfo' is searched for a
<span class="lineno">  515 </span>-- requested file, and the file is served with the appropriate mime type if it
<span class="lineno">  516 </span>-- is found. Absolute paths and \&quot;@..@\&quot; are prohibited to prevent files from
<span class="lineno">  517 </span>-- being served from outside the sandbox.
<span class="lineno">  518 </span>serveDirectoryWith :: MonadSnap m
<span class="lineno">  519 </span>                   =&gt; DirectoryConfig m  -- ^ Configuration options
<span class="lineno">  520 </span>                   -&gt; FilePath           -- ^ Directory to serve from
<span class="lineno">  521 </span>                   -&gt; m ()
<span class="lineno">  522 </span><span class="decl"><span class="istickedoff">serveDirectoryWith cfg base = do</span>
<span class="lineno">  523 </span><span class="spaces">    </span><span class="istickedoff">b &lt;- directory &lt;|&gt; file &lt;|&gt; redir</span>
<span class="lineno">  524 </span><span class="spaces">    </span><span class="istickedoff">when (not b) pass</span>
<span class="lineno">  525 </span><span class="spaces"></span><span class="istickedoff"></span>
<span class="lineno">  526 </span><span class="spaces">  </span><span class="istickedoff">where</span>
<span class="lineno">  527 </span><span class="spaces">    </span><span class="istickedoff">idxs     = indexFiles cfg</span>
<span class="lineno">  528 </span><span class="spaces">    </span><span class="istickedoff">generate = indexGenerator cfg</span>
<span class="lineno">  529 </span><span class="spaces">    </span><span class="istickedoff">mimes    = mimeTypes cfg</span>
<span class="lineno">  530 </span><span class="spaces">    </span><span class="istickedoff">dyns     = dynamicHandlers cfg</span>
<span class="lineno">  531 </span><span class="spaces">    </span><span class="istickedoff">pshook   = preServeHook cfg</span>
<span class="lineno">  532 </span><span class="spaces"></span><span class="istickedoff"></span>
<span class="lineno">  533 </span><span class="spaces">    </span><span class="istickedoff">-- Serves a file if it exists; passes if not</span>
<span class="lineno">  534 </span><span class="spaces">    </span><span class="istickedoff">serve f = do</span>
<span class="lineno">  535 </span><span class="spaces">        </span><span class="istickedoff">liftIO (doesFileExist f) &gt;&gt;= flip unless pass</span>
<span class="lineno">  536 </span><span class="spaces">        </span><span class="istickedoff">let fname          = takeFileName f</span>
<span class="lineno">  537 </span><span class="spaces">        </span><span class="istickedoff">let staticServe f' = pshook f &gt;&gt; serveFileAs (fileType mimes fname) f'</span>
<span class="lineno">  538 </span><span class="spaces">        </span><span class="istickedoff">lookupExt staticServe dyns fname f &gt;&gt; return True</span>
<span class="lineno">  539 </span><span class="spaces"></span><span class="istickedoff"></span>
<span class="lineno">  540 </span><span class="spaces">    </span><span class="istickedoff">-- Serves a directory via indices if available.  Returns True on success,</span>
<span class="lineno">  541 </span><span class="spaces">    </span><span class="istickedoff">-- False on failure to find an index.  Passes /only/ if the request was</span>
<span class="lineno">  542 </span><span class="spaces">    </span><span class="istickedoff">-- not for a directory (no trailing slash).</span>
<span class="lineno">  543 </span><span class="spaces">    </span><span class="istickedoff">directory = do</span>
<span class="lineno">  544 </span><span class="spaces">        </span><span class="istickedoff">rq  &lt;- getRequest</span>
<span class="lineno">  545 </span><span class="spaces">        </span><span class="istickedoff">let uri = uriWithoutQueryString rq</span>
<span class="lineno">  546 </span><span class="spaces">        </span><span class="istickedoff">unless (&quot;/&quot; `S.isSuffixOf` uri) pass</span>
<span class="lineno">  547 </span><span class="spaces">        </span><span class="istickedoff">rel &lt;- (base &lt;/&gt;) &lt;$&gt; getSafePath</span>
<span class="lineno">  548 </span><span class="spaces">        </span><span class="istickedoff">b   &lt;- liftIO $ doesDirectoryExist rel</span>
<span class="lineno">  549 </span><span class="spaces">        </span><span class="istickedoff">if b then do let serveRel f = serve (rel &lt;/&gt; f)</span>
<span class="lineno">  550 </span><span class="spaces">                     </span><span class="istickedoff">foldl' (&lt;|&gt;) pass (Prelude.map serveRel idxs)</span>
<span class="lineno">  551 </span><span class="spaces">                         </span><span class="istickedoff">&lt;|&gt; (generate rel &gt;&gt; return True)</span>
<span class="lineno">  552 </span><span class="spaces">                         </span><span class="istickedoff">&lt;|&gt; return False</span>
<span class="lineno">  553 </span><span class="spaces">             </span><span class="istickedoff">else return False</span>
<span class="lineno">  554 </span><span class="spaces"></span><span class="istickedoff"></span>
<span class="lineno">  555 </span><span class="spaces">    </span><span class="istickedoff">-- Serves a file requested by name.  Passes if the file doesn't exist.</span>
<span class="lineno">  556 </span><span class="spaces">    </span><span class="istickedoff">file = serve =&lt;&lt; ((base &lt;/&gt;) &lt;$&gt; getSafePath)</span>
<span class="lineno">  557 </span><span class="spaces"></span><span class="istickedoff"></span>
<span class="lineno">  558 </span><span class="spaces">    </span><span class="istickedoff">-- If the request is for a directory but lacks a trailing slash, redirects</span>
<span class="lineno">  559 </span><span class="spaces">    </span><span class="istickedoff">-- to the directory name with a trailing slash.</span>
<span class="lineno">  560 </span><span class="spaces">    </span><span class="istickedoff">redir = do</span>
<span class="lineno">  561 </span><span class="spaces">        </span><span class="istickedoff">rel &lt;- (base &lt;/&gt;) &lt;$&gt; getSafePath</span>
<span class="lineno">  562 </span><span class="spaces">        </span><span class="istickedoff">liftIO (doesDirectoryExist rel) &gt;&gt;= flip unless pass</span>
<span class="lineno">  563 </span><span class="spaces">        </span><span class="istickedoff">rq &lt;- getRequest</span>
<span class="lineno">  564 </span><span class="spaces">        </span><span class="istickedoff">let uri = uriWithoutQueryString rq</span>
<span class="lineno">  565 </span><span class="spaces">        </span><span class="istickedoff">let qss = queryStringSuffix rq</span>
<span class="lineno">  566 </span><span class="spaces">        </span><span class="istickedoff">let u = S.concat [uri, &quot;/&quot;, qss]</span>
<span class="lineno">  567 </span><span class="spaces">        </span><span class="istickedoff">redirect u</span></span>
<span class="lineno">  568 </span>
<span class="lineno">  569 </span>
<span class="lineno">  570 </span>------------------------------------------------------------------------------
<span class="lineno">  571 </span>-- | Serves a single file specified by a full or relative path.  If the file
<span class="lineno">  572 </span>-- does not exist, throws an exception (not that it does /not/ pass to the
<span class="lineno">  573 </span>-- next handler).   The path restrictions on 'serveDirectory' don't apply to
<span class="lineno">  574 </span>-- this function since the path is not being supplied by the user.
<span class="lineno">  575 </span>serveFile :: MonadSnap m
<span class="lineno">  576 </span>          =&gt; FilePath          -- ^ path to file
<span class="lineno">  577 </span>          -&gt; m ()
<span class="lineno">  578 </span><span class="decl"><span class="istickedoff">serveFile fp = serveFileAs (fileType defaultMimeTypes (takeFileName fp)) fp</span></span>
<span class="lineno">  579 </span>{-# INLINE serveFile #-}
<span class="lineno">  580 </span>
<span class="lineno">  581 </span>
<span class="lineno">  582 </span>------------------------------------------------------------------------------
<span class="lineno">  583 </span>-- | Same as 'serveFile', with control over the MIME mapping used.
<span class="lineno">  584 </span>serveFileAs :: MonadSnap m
<span class="lineno">  585 </span>            =&gt; ByteString        -- ^ MIME type
<span class="lineno">  586 </span>            -&gt; FilePath          -- ^ path to file
<span class="lineno">  587 </span>            -&gt; m ()
<span class="lineno">  588 </span><span class="decl"><span class="istickedoff">serveFileAs mime fp = do</span>
<span class="lineno">  589 </span><span class="spaces">    </span><span class="istickedoff">reqOrig &lt;- getRequest</span>
<span class="lineno">  590 </span><span class="spaces"></span><span class="istickedoff"></span>
<span class="lineno">  591 </span><span class="spaces">    </span><span class="istickedoff">-- If-Range header must be ignored if there is no Range: header in the</span>
<span class="lineno">  592 </span><span class="spaces">    </span><span class="istickedoff">-- request (RFC 2616 section 14.27)</span>
<span class="lineno">  593 </span><span class="spaces">    </span><span class="istickedoff">let req = if isNothing $ getHeader &quot;range&quot; reqOrig</span>
<span class="lineno">  594 </span><span class="spaces">                </span><span class="istickedoff">then deleteHeader &quot;if-range&quot; reqOrig</span>
<span class="lineno">  595 </span><span class="spaces">                </span><span class="istickedoff">else reqOrig</span>
<span class="lineno">  596 </span><span class="spaces"></span><span class="istickedoff"></span>
<span class="lineno">  597 </span><span class="spaces">    </span><span class="istickedoff">-- check &quot;If-Modified-Since&quot; and &quot;If-Range&quot; headers</span>
<span class="lineno">  598 </span><span class="spaces">    </span><span class="istickedoff">let mbH = getHeader &quot;if-modified-since&quot; req</span>
<span class="lineno">  599 </span><span class="spaces">    </span><span class="istickedoff">mbIfModified &lt;- liftIO $ case mbH of</span>
<span class="lineno">  600 </span><span class="spaces">                               </span><span class="istickedoff">Nothing  -&gt; return Nothing</span>
<span class="lineno">  601 </span><span class="spaces">                               </span><span class="istickedoff">(Just s) -&gt; liftM Just $ parseHttpTime s</span>
<span class="lineno">  602 </span><span class="spaces"></span><span class="istickedoff"></span>
<span class="lineno">  603 </span><span class="spaces">    </span><span class="istickedoff">-- If-Range header could contain an entity, but then parseHttpTime will</span>
<span class="lineno">  604 </span><span class="spaces">    </span><span class="istickedoff">-- fail and return 0 which means a 200 response will be generated anyways</span>
<span class="lineno">  605 </span><span class="spaces">    </span><span class="istickedoff">mbIfRange &lt;- liftIO $ case getHeader &quot;if-range&quot; req of</span>
<span class="lineno">  606 </span><span class="spaces">                            </span><span class="istickedoff">Nothing  -&gt; return Nothing</span>
<span class="lineno">  607 </span><span class="spaces">                            </span><span class="istickedoff">(Just s) -&gt; liftM Just $ parseHttpTime s</span>
<span class="lineno">  608 </span><span class="spaces"></span><span class="istickedoff"></span>
<span class="lineno">  609 </span><span class="spaces">    </span><span class="istickedoff">dbg $ <span class="nottickedoff">&quot;mbIfModified: &quot; ++ Prelude.show mbIfModified</span></span>
<span class="lineno">  610 </span><span class="spaces">    </span><span class="istickedoff">dbg $ <span class="nottickedoff">&quot;mbIfRange: &quot; ++ Prelude.show mbIfRange</span></span>
<span class="lineno">  611 </span><span class="spaces"></span><span class="istickedoff"></span>
<span class="lineno">  612 </span><span class="spaces">    </span><span class="istickedoff">-- check modification time and bug out early if the file is not modified.</span>
<span class="lineno">  613 </span><span class="spaces">    </span><span class="istickedoff">--</span>
<span class="lineno">  614 </span><span class="spaces">    </span><span class="istickedoff">-- TODO: a stat cache would be nice here, but it'd need the date thread</span>
<span class="lineno">  615 </span><span class="spaces">    </span><span class="istickedoff">-- stuff from snap-server to be folded into snap-core</span>
<span class="lineno">  616 </span><span class="spaces">    </span><span class="istickedoff">filestat &lt;- liftIO $ getFileStatus fp</span>
<span class="lineno">  617 </span><span class="spaces">    </span><span class="istickedoff">let mt = modificationTime filestat</span>
<span class="lineno">  618 </span><span class="spaces">    </span><span class="istickedoff">maybe (return $! ()) (\lt -&gt; when (mt &lt;= lt) notModified) mbIfModified</span>
<span class="lineno">  619 </span><span class="spaces"></span><span class="istickedoff"></span>
<span class="lineno">  620 </span><span class="spaces">    </span><span class="istickedoff">let sz = fromIntegral $ fileSize filestat</span>
<span class="lineno">  621 </span><span class="spaces">    </span><span class="istickedoff">lm &lt;- liftIO $ formatHttpTime mt</span>
<span class="lineno">  622 </span><span class="spaces"></span><span class="istickedoff"></span>
<span class="lineno">  623 </span><span class="spaces">    </span><span class="istickedoff">-- ok, at this point we know the last-modified time and the</span>
<span class="lineno">  624 </span><span class="spaces">    </span><span class="istickedoff">-- content-type. set those.</span>
<span class="lineno">  625 </span><span class="spaces">    </span><span class="istickedoff">modifyResponse $ setHeader &quot;Last-Modified&quot; lm</span>
<span class="lineno">  626 </span><span class="spaces">                   </span><span class="istickedoff">. setHeader &quot;Accept-Ranges&quot; &quot;bytes&quot;</span>
<span class="lineno">  627 </span><span class="spaces">                   </span><span class="istickedoff">. setContentType mime</span>
<span class="lineno">  628 </span><span class="spaces"></span><span class="istickedoff"></span>
<span class="lineno">  629 </span><span class="spaces"></span><span class="istickedoff"></span>
<span class="lineno">  630 </span><span class="spaces">    </span><span class="istickedoff">-- now check: is this a range request? If there is an 'If-Range' header</span>
<span class="lineno">  631 </span><span class="spaces">    </span><span class="istickedoff">-- with an old modification time we skip this check and send a 200</span>
<span class="lineno">  632 </span><span class="spaces">    </span><span class="istickedoff">-- response</span>
<span class="lineno">  633 </span><span class="spaces">    </span><span class="istickedoff">let skipRangeCheck = maybe (False)</span>
<span class="lineno">  634 </span><span class="spaces">                               </span><span class="istickedoff">(\lt -&gt; mt &gt; lt)</span>
<span class="lineno">  635 </span><span class="spaces">                               </span><span class="istickedoff">mbIfRange</span>
<span class="lineno">  636 </span><span class="spaces"></span><span class="istickedoff"></span>
<span class="lineno">  637 </span><span class="spaces">    </span><span class="istickedoff">-- checkRangeReq checks for a Range: header in the request and sends a</span>
<span class="lineno">  638 </span><span class="spaces">    </span><span class="istickedoff">-- partial response if it matches.</span>
<span class="lineno">  639 </span><span class="spaces">    </span><span class="istickedoff">wasRange &lt;- if skipRangeCheck</span>
<span class="lineno">  640 </span><span class="spaces">                  </span><span class="istickedoff">then return False</span>
<span class="lineno">  641 </span><span class="spaces">                  </span><span class="istickedoff">else liftSnap $ checkRangeReq req fp sz</span>
<span class="lineno">  642 </span><span class="spaces"></span><span class="istickedoff"></span>
<span class="lineno">  643 </span><span class="spaces">    </span><span class="istickedoff">dbg $ <span class="nottickedoff">&quot;was this a range request? &quot; ++ Prelude.show wasRange</span></span>
<span class="lineno">  644 </span><span class="spaces"></span><span class="istickedoff"></span>
<span class="lineno">  645 </span><span class="spaces">    </span><span class="istickedoff">-- if we didn't have a range request, we just do normal sendfile</span>
<span class="lineno">  646 </span><span class="spaces">    </span><span class="istickedoff">unless wasRange $ do</span>
<span class="lineno">  647 </span><span class="spaces">      </span><span class="istickedoff">modifyResponse $ setResponseCode 200</span>
<span class="lineno">  648 </span><span class="spaces">                     </span><span class="istickedoff">. setContentLength sz</span>
<span class="lineno">  649 </span><span class="spaces">      </span><span class="istickedoff">liftSnap $ sendFile fp</span>
<span class="lineno">  650 </span><span class="spaces"></span><span class="istickedoff"></span>
<span class="lineno">  651 </span><span class="spaces">  </span><span class="istickedoff">where</span>
<span class="lineno">  652 </span><span class="spaces">    </span><span class="istickedoff">--------------------------------------------------------------------------</span>
<span class="lineno">  653 </span><span class="spaces">    </span><span class="istickedoff">notModified = finishWith $</span>
<span class="lineno">  654 </span><span class="spaces">                  </span><span class="istickedoff">setResponseCode 304 emptyResponse</span></span>
<span class="lineno">  655 </span>
<span class="lineno">  656 </span>
<span class="lineno">  657 </span>------------------------------------------------------------------------------
<span class="lineno">  658 </span>lookupExt :: a -&gt; HashMap FilePath a -&gt; FilePath -&gt; a
<span class="lineno">  659 </span><span class="decl"><span class="istickedoff">lookupExt def m f =</span>
<span class="lineno">  660 </span><span class="spaces">    </span><span class="istickedoff">if null ext</span>
<span class="lineno">  661 </span><span class="spaces">      </span><span class="istickedoff">then def</span>
<span class="lineno">  662 </span><span class="spaces">      </span><span class="istickedoff">else fromMaybe (lookupExt def m (next ext)) mbe</span>
<span class="lineno">  663 </span><span class="spaces"></span><span class="istickedoff"></span>
<span class="lineno">  664 </span><span class="spaces">  </span><span class="istickedoff">where</span>
<span class="lineno">  665 </span><span class="spaces">    </span><span class="istickedoff">next            = dropWhile (/= '.') . drop 1</span>
<span class="lineno">  666 </span><span class="spaces">    </span><span class="istickedoff">ext             = takeExtensions f</span>
<span class="lineno">  667 </span><span class="spaces">    </span><span class="istickedoff">mbe             = Map.lookup ext m</span></span>
<span class="lineno">  668 </span>
<span class="lineno">  669 </span>
<span class="lineno">  670 </span>------------------------------------------------------------------------------
<span class="lineno">  671 </span>-- | Determine a given file's MIME type from its filename and the provided MIME
<span class="lineno">  672 </span>-- map.
<span class="lineno">  673 </span>fileType :: MimeMap -&gt; FilePath -&gt; ByteString
<span class="lineno">  674 </span><span class="decl"><span class="istickedoff">fileType = lookupExt defaultMimeType</span></span>
<span class="lineno">  675 </span>
<span class="lineno">  676 </span>
<span class="lineno">  677 </span>------------------------------------------------------------------------------
<span class="lineno">  678 </span>defaultMimeType :: ByteString
<span class="lineno">  679 </span><span class="decl"><span class="istickedoff">defaultMimeType = &quot;application/octet-stream&quot;</span></span>
<span class="lineno">  680 </span>
<span class="lineno">  681 </span>
<span class="lineno">  682 </span>------------------------------------------------------------------------------
<span class="lineno">  683 </span>data RangeReq = RangeReq !Word64 !(Maybe Word64)
<span class="lineno">  684 </span>              | SuffixRangeReq !Word64
<span class="lineno">  685 </span>
<span class="lineno">  686 </span>
<span class="lineno">  687 </span>------------------------------------------------------------------------------
<span class="lineno">  688 </span>rangeParser :: Parser RangeReq
<span class="lineno">  689 </span><span class="decl"><span class="istickedoff">rangeParser = string &quot;bytes=&quot; *&gt;</span>
<span class="lineno">  690 </span><span class="spaces">              </span><span class="istickedoff">(byteRangeSpec &lt;|&gt; suffixByteRangeSpec) &lt;*</span>
<span class="lineno">  691 </span><span class="spaces">              </span><span class="istickedoff">endOfInput</span>
<span class="lineno">  692 </span><span class="spaces">  </span><span class="istickedoff">where</span>
<span class="lineno">  693 </span><span class="spaces">    </span><span class="istickedoff">byteRangeSpec = do</span>
<span class="lineno">  694 </span><span class="spaces">        </span><span class="istickedoff">start &lt;- fromIntegral &lt;$&gt; parseNum</span>
<span class="lineno">  695 </span><span class="spaces">        </span><span class="istickedoff">void $! char '-'</span>
<span class="lineno">  696 </span><span class="spaces">        </span><span class="istickedoff">end   &lt;- option Nothing $ liftM Just parseNum</span>
<span class="lineno">  697 </span><span class="spaces"></span><span class="istickedoff"></span>
<span class="lineno">  698 </span><span class="spaces">        </span><span class="istickedoff">return $! RangeReq start (fromIntegral &lt;$&gt; end)</span>
<span class="lineno">  699 </span><span class="spaces"></span><span class="istickedoff"></span>
<span class="lineno">  700 </span><span class="spaces">    </span><span class="istickedoff">suffixByteRangeSpec =</span>
<span class="lineno">  701 </span><span class="spaces">        </span><span class="istickedoff">liftM (SuffixRangeReq . fromIntegral) $ char '-' *&gt; parseNum</span></span>
<span class="lineno">  702 </span>
<span class="lineno">  703 </span>
<span class="lineno">  704 </span>------------------------------------------------------------------------------
<span class="lineno">  705 </span>checkRangeReq :: (MonadSnap m) =&gt; Request -&gt; FilePath -&gt; Word64 -&gt; m Bool
<span class="lineno">  706 </span><span class="decl"><span class="istickedoff">checkRangeReq req fp sz = do</span>
<span class="lineno">  707 </span><span class="spaces">    </span><span class="istickedoff">-- TODO/FIXME: multiple ranges</span>
<span class="lineno">  708 </span><span class="spaces">    </span><span class="istickedoff">maybe (return False)</span>
<span class="lineno">  709 </span><span class="spaces">          </span><span class="istickedoff">(\s -&gt; either (const $ return False)</span>
<span class="lineno">  710 </span><span class="spaces">                        </span><span class="istickedoff">withRange</span>
<span class="lineno">  711 </span><span class="spaces">                        </span><span class="istickedoff">(fullyParse s rangeParser))</span>
<span class="lineno">  712 </span><span class="spaces">          </span><span class="istickedoff">(getHeader &quot;range&quot; req)</span>
<span class="lineno">  713 </span><span class="spaces"></span><span class="istickedoff"></span>
<span class="lineno">  714 </span><span class="spaces">  </span><span class="istickedoff">where</span>
<span class="lineno">  715 </span><span class="spaces">    </span><span class="istickedoff">withRange (RangeReq start mend) = do</span>
<span class="lineno">  716 </span><span class="spaces">        </span><span class="istickedoff">let end = fromMaybe (sz-1) mend</span>
<span class="lineno">  717 </span><span class="spaces">        </span><span class="istickedoff">dbg $ <span class="nottickedoff">&quot;withRange: start=&quot; ++ Prelude.show start</span></span>
<span class="lineno">  718 </span><span class="spaces">                  </span><span class="istickedoff"><span class="nottickedoff">++ &quot;, end=&quot; ++ Prelude.show end</span></span>
<span class="lineno">  719 </span><span class="spaces"></span><span class="istickedoff"></span>
<span class="lineno">  720 </span><span class="spaces">        </span><span class="istickedoff">if start &lt; 0 || end &lt; start || start &gt;= sz || end &gt;= sz</span>
<span class="lineno">  721 </span><span class="spaces">           </span><span class="istickedoff">then send416</span>
<span class="lineno">  722 </span><span class="spaces">           </span><span class="istickedoff">else send206 start end</span>
<span class="lineno">  723 </span><span class="spaces"></span><span class="istickedoff"></span>
<span class="lineno">  724 </span><span class="spaces">    </span><span class="istickedoff">withRange (SuffixRangeReq nbytes) = do</span>
<span class="lineno">  725 </span><span class="spaces">        </span><span class="istickedoff">let end   = sz-1</span>
<span class="lineno">  726 </span><span class="spaces">        </span><span class="istickedoff">let start = sz - nbytes</span>
<span class="lineno">  727 </span><span class="spaces"></span><span class="istickedoff"></span>
<span class="lineno">  728 </span><span class="spaces">        </span><span class="istickedoff">dbg $ <span class="nottickedoff">&quot;withRange: start=&quot; ++ Prelude.show start</span></span>
<span class="lineno">  729 </span><span class="spaces">                  </span><span class="istickedoff"><span class="nottickedoff">++ &quot;, end=&quot; ++ Prelude.show end</span></span>
<span class="lineno">  730 </span><span class="spaces"></span><span class="istickedoff"></span>
<span class="lineno">  731 </span><span class="spaces">        </span><span class="istickedoff">if start &lt; 0 || end &lt; start || start &gt;= sz || end &gt;= sz</span>
<span class="lineno">  732 </span><span class="spaces">           </span><span class="istickedoff">then send416</span>
<span class="lineno">  733 </span><span class="spaces">           </span><span class="istickedoff">else send206 start end</span>
<span class="lineno">  734 </span><span class="spaces"></span><span class="istickedoff"></span>
<span class="lineno">  735 </span><span class="spaces">    </span><span class="istickedoff">-- note: start and end INCLUSIVE here</span>
<span class="lineno">  736 </span><span class="spaces">    </span><span class="istickedoff">send206 start end = do</span>
<span class="lineno">  737 </span><span class="spaces">        </span><span class="istickedoff">dbg <span class="nottickedoff">&quot;inside send206&quot;</span></span>
<span class="lineno">  738 </span><span class="spaces">        </span><span class="istickedoff">let !len = end-start+1</span>
<span class="lineno">  739 </span><span class="spaces">        </span><span class="istickedoff">let crng = S.concat . L.toChunks $</span>
<span class="lineno">  740 </span><span class="spaces">                   </span><span class="istickedoff">toLazyByteString $</span>
<span class="lineno">  741 </span><span class="spaces">                   </span><span class="istickedoff">mconcat [ byteString &quot;bytes &quot;</span>
<span class="lineno">  742 </span><span class="spaces">                           </span><span class="istickedoff">, fromShow start</span>
<span class="lineno">  743 </span><span class="spaces">                           </span><span class="istickedoff">, char8 '-'</span>
<span class="lineno">  744 </span><span class="spaces">                           </span><span class="istickedoff">, fromShow end</span>
<span class="lineno">  745 </span><span class="spaces">                           </span><span class="istickedoff">, char8 '/'</span>
<span class="lineno">  746 </span><span class="spaces">                           </span><span class="istickedoff">, fromShow sz ]</span>
<span class="lineno">  747 </span><span class="spaces"></span><span class="istickedoff"></span>
<span class="lineno">  748 </span><span class="spaces">        </span><span class="istickedoff">modifyResponse $ setResponseCode 206</span>
<span class="lineno">  749 </span><span class="spaces">                       </span><span class="istickedoff">. setHeader &quot;Content-Range&quot; crng</span>
<span class="lineno">  750 </span><span class="spaces">                       </span><span class="istickedoff">. setContentLength len</span>
<span class="lineno">  751 </span><span class="spaces"></span><span class="istickedoff"></span>
<span class="lineno">  752 </span><span class="spaces">        </span><span class="istickedoff">dbg $ <span class="nottickedoff">&quot;send206: sending range (&quot; ++ Prelude.show start</span></span>
<span class="lineno">  753 </span><span class="spaces">                </span><span class="istickedoff"><span class="nottickedoff">++ &quot;,&quot; ++ Prelude.show (end+1) ++ &quot;) to sendFilePartial&quot;</span></span>
<span class="lineno">  754 </span><span class="spaces"></span><span class="istickedoff"></span>
<span class="lineno">  755 </span><span class="spaces">        </span><span class="istickedoff">-- end here was inclusive, sendFilePartial is exclusive</span>
<span class="lineno">  756 </span><span class="spaces">        </span><span class="istickedoff">sendFilePartial fp (start,end+1)</span>
<span class="lineno">  757 </span><span class="spaces">        </span><span class="istickedoff">return True</span>
<span class="lineno">  758 </span><span class="spaces"></span><span class="istickedoff"></span>
<span class="lineno">  759 </span><span class="spaces"></span><span class="istickedoff"></span>
<span class="lineno">  760 </span><span class="spaces">    </span><span class="istickedoff">send416 = do</span>
<span class="lineno">  761 </span><span class="spaces">        </span><span class="istickedoff">dbg <span class="nottickedoff">&quot;inside send416&quot;</span></span>
<span class="lineno">  762 </span><span class="spaces">        </span><span class="istickedoff">-- if there's an &quot;If-Range&quot; header in the request, then we just send</span>
<span class="lineno">  763 </span><span class="spaces">        </span><span class="istickedoff">-- back 200</span>
<span class="lineno">  764 </span><span class="spaces">        </span><span class="istickedoff">if getHeader &quot;If-Range&quot; req /= Nothing</span>
<span class="lineno">  765 </span><span class="spaces">           </span><span class="istickedoff">then return False</span>
<span class="lineno">  766 </span><span class="spaces">           </span><span class="istickedoff">else do</span>
<span class="lineno">  767 </span><span class="spaces">               </span><span class="istickedoff">let crng = S.concat . L.toChunks $</span>
<span class="lineno">  768 </span><span class="spaces">                          </span><span class="istickedoff">toLazyByteString $</span>
<span class="lineno">  769 </span><span class="spaces">                          </span><span class="istickedoff">mconcat [ byteString &quot;bytes */&quot;</span>
<span class="lineno">  770 </span><span class="spaces">                                  </span><span class="istickedoff">, fromShow sz ]</span>
<span class="lineno">  771 </span><span class="spaces"></span><span class="istickedoff"></span>
<span class="lineno">  772 </span><span class="spaces">               </span><span class="istickedoff">modifyResponse $ setResponseCode 416</span>
<span class="lineno">  773 </span><span class="spaces">                              </span><span class="istickedoff">. setHeader &quot;Content-Range&quot; crng</span>
<span class="lineno">  774 </span><span class="spaces">                              </span><span class="istickedoff">. setContentLength 0</span>
<span class="lineno">  775 </span><span class="spaces">                              </span><span class="istickedoff">. deleteHeader &quot;Content-Type&quot;</span>
<span class="lineno">  776 </span><span class="spaces">                              </span><span class="istickedoff">. deleteHeader &quot;Content-Encoding&quot;</span>
<span class="lineno">  777 </span><span class="spaces">                              </span><span class="istickedoff">. deleteHeader &quot;Transfer-Encoding&quot;</span>
<span class="lineno">  778 </span><span class="spaces">                              </span><span class="istickedoff">. setResponseBody (return . id)</span>
<span class="lineno">  779 </span><span class="spaces"></span><span class="istickedoff"></span>
<span class="lineno">  780 </span><span class="spaces">               </span><span class="istickedoff">return True</span></span>
<span class="lineno">  781 </span>
<span class="lineno">  782 </span>
<span class="lineno">  783 </span>------------------------------------------------------------------------------
<span class="lineno">  784 </span>dbg :: (MonadIO m) =&gt; String -&gt; m ()
<span class="lineno">  785 </span><span class="decl"><span class="istickedoff">dbg s = debug $ <span class="nottickedoff">&quot;FileServe:&quot; ++ s</span></span></span>
<span class="lineno">  786 </span>
<span class="lineno">  787 </span>
<span class="lineno">  788 </span>------------------------------------------------------------------------------
<span class="lineno">  789 </span>uriWithoutQueryString :: Request -&gt; ByteString
<span class="lineno">  790 </span><span class="decl"><span class="istickedoff">uriWithoutQueryString rq = S.takeWhile (/= '?') uri</span>
<span class="lineno">  791 </span><span class="spaces">  </span><span class="istickedoff">where</span>
<span class="lineno">  792 </span><span class="spaces">    </span><span class="istickedoff">uri   = rqURI rq</span></span>
<span class="lineno">  793 </span>
<span class="lineno">  794 </span>
<span class="lineno">  795 </span>------------------------------------------------------------------------------
<span class="lineno">  796 </span>queryStringSuffix :: Request -&gt; ByteString
<span class="lineno">  797 </span><span class="decl"><span class="istickedoff">queryStringSuffix rq = S.concat [ s, qs ]</span>
<span class="lineno">  798 </span><span class="spaces">  </span><span class="istickedoff">where</span>
<span class="lineno">  799 </span><span class="spaces">    </span><span class="istickedoff">qs = rqQueryString rq</span>
<span class="lineno">  800 </span><span class="spaces">    </span><span class="istickedoff">s  = if S.null qs then &quot;&quot; else &quot;?&quot;</span></span>
<span class="lineno">  801 </span>
<span class="lineno">  802 </span>
<span class="lineno">  803 </span>------------------------------------------------------------------------------
<span class="lineno">  804 </span>fromShow :: Show a =&gt; a -&gt; Builder
<span class="lineno">  805 </span><span class="decl"><span class="istickedoff">fromShow = stringUtf8 . show</span></span>

</pre>
</html>
